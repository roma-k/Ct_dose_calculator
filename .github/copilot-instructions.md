# Copilot / Agent instructions — Ct_dose_calculator

Краткие указания для AI-агентов, чтобы быстро стать продуктивным в этом репозитории.

1. Назначение проекта
- Небольшой одностраничный веб‑калькулятор эффективной дозы КТ.
 - Публичная веб-версия: `index.html` + `script.js` + `style.css`.
 - В репозитории есть папка `OLD/` с архивными/ненужными сейчас файлами. По умолчанию не учитывать. В ней может быть Streamlit‑вариант `OLD/by_python/ct_dose_calculator_web.py` (архив).

2. Большая картина / поток данных
- Пользователь вводит DLP через виртуальную клавиатуру в `index.html` (элемент `#display`).
- `script.js` содержит константу `COEFFICIENTS` и функцию `calculateED(dlp)` которая:
  - читает выбранный `region` и `age` из радио-кнопок,
  - берёт коэффициент `k = COEFFICIENTS[region][age]`, вычисляет `ed = dlp * k` и выводит результат в `#result`.
- UI события: клавиатурные кнопки и радиокнопки вызывают `calculateED()`; тема переключается чекбоксом `#theme-toggle`.

3. Ключевые файлы для изучения
- `index.html` — структура UI: виртуальная клавиатура, группы радио-кнопок, `#display`, `#result`.
- `script.js` — логика: `keyBoard()`, `calculateED()`, `toggleTheme()`, и `COEFFICIENTS`.
 - `style.css` — темы и стили; JS поддерживает смену класса `dark-theme` на `body`.
 - `OLD/by_python/ct_dose_calculator_web.py` — архивный Streamlit-скрипт (парсинг PDF через PyPDF2). Игнорировать по умолчанию.

4. Развертывание и отладка (быстро)
- Веб-версию можно открыть напрямую в браузере: откройте `index.html` или запустите статический сервер из корня:

  python -m http.server 8000

 - Streamlit-версию (в архиве `OLD/`, игнорируйте по умолчанию). Если нужно запустить, установите зависимости (`streamlit`, `PyPDF2`, `pandas`) и запустите:

  streamlit run OLD/by_python/ct_dose_calculator_web.py

- Нет сборки/CI в репо — правки JS/CSS применяются после перезагрузки страницы.

5. Проектные соглашения и паттерны
- Коэффициенты дублируются в `script.js` и в Python-версии; при изменении — обновлять оба места.
- Радио-кнопки в HTML используют `onchange="calculateED()"` — JS ожидает, что выбранные элементы существуют (т.е. запускать после `DOMContentLoaded`).
- Виртуальная клавиатура использует значения: `C` (clear), `B` (backspace) и цифры; `keyBoard()` вызывает `calculateED()` с `DISPLAY.textContent`.

6. Важные детали и частые источники ошибок
- `calculateED()` защищает от пустого/нечислового DLP: внутри используется `parseFloat(document.getElementById('display').textContent) || 0`.
- Если `region` или `age` равны `null` (например, вызов до загрузки DOM), функция покажет ошибку — запускайте анализ после `DOMContentLoaded`.
- При изменении логики формата DLP (например, добавлении запятой/разделителей) обновите парсинг в `calculateED()`.

7. Интеграции и зависимости
- Веб-версия — чистый статический фронтенд, внешних API нет.
 - Streamlit-версия (архив `OLD/`) требует `streamlit`, `PyPDF2`, `pandas` (см. импорты в `OLD/by_python/ct_dose_calculator_web.py`).

8. Что ожидать от агента
- При изменениях в расчётах: обновить `COEFFICIENTS` в обеих реализациях или предложить вынести их в единый JSON/файл конфигурации.
- При улучшении UX: правьте `index.html` + `script.js`; упрощайте обработку пустых/неправильных значений `display`.
- Для добавления тестов: нет существующей тестовой инфраструктуры — предложите minimal manual checklist (открыть `index.html`, ввести значения, проверить результат).

Если что-то неполное или нужна дополнительная информация (например, куда сохранять результаты, желаемый формат CSV/логирования, CI), скажите — внесу правки.
